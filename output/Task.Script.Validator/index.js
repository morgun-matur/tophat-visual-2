// Generated by purs version 0.14.2
"use strict";
var Control_Bind = require("../Control.Bind/index.js");
var Data_Either = require("../Data.Either/index.js");
var Data_Eq = require("../Data.Eq/index.js");
var Data_Foldable = require("../Data.Foldable/index.js");
var Data_Functor = require("../Data.Functor/index.js");
var Data_HashMap = require("../Data.HashMap/index.js");
var Data_Hashable = require("../Data.Hashable/index.js");
var Data_Traversable = require("../Data.Traversable/index.js");
var Data_Tuple = require("../Data.Tuple/index.js");
var Preload = require("../Preload/index.js");
var Task_Script_Annotation = require("../Task.Script.Annotation/index.js");
var Task_Script_Checker = require("../Task.Script.Checker/index.js");
var Task_Script_Error = require("../Task.Script.Error/index.js");
var Task_Script_Syntax = require("../Task.Script.Syntax/index.js");
var Task_Script_Type = require("../Task.Script.Type/index.js");
var outofBranch = Control_Bind.composeKleisli(Data_Either.bindEither)(Task_Script_Annotation.extractType)(Task_Script_Checker.outofTask);
var validate = function (s) {
    return function (g) {
        return function (v) {
            var validate1 = function (v1) {
                var v2 = validate(s)(g)(v1);
                if (v2.value0 instanceof Task_Script_Annotation.Success) {
                    if (v2.value0.value1 instanceof Task_Script_Type.TTask) {
                        return Task_Script_Annotation.pass(v2.value0.value0)(v2.value1)(v2.value0.value1);
                    };
                    return Task_Script_Annotation.fail(v2.value0.value0)(v1.value1)(new Task_Script_Error.TaskNeeded(v2.value0.value1));
                };
                return v2;
            };
            var validate2 = function (v1) {
                return new Data_Tuple.Tuple(v1.value0, (function () {
                    var v2 = Task_Script_Checker.check(Task_Script_Checker["$_CheckExpression_8"])(s)(g)(v1.value0);
                    if (v2 instanceof Data_Either.Right && (v2.value0 instanceof Task_Script_Type.TPrimitive && v2.value0.value0 instanceof Task_Script_Type.TBool)) {
                        return validate1(v1.value1);
                    };
                    if (v2 instanceof Data_Either.Right) {
                        return Task_Script_Annotation.fail(g)(v1.value1.value1)(new Task_Script_Error.BoolNeeded(v2.value0));
                    };
                    if (v2 instanceof Data_Either.Left) {
                        return Task_Script_Annotation.fail(g)(v1.value1.value1)(v2.value0);
                    };
                    throw new Error("Failed pattern match at Task.Script.Validator (line 102, column 9 - line 105, column 32): " + [ v2.constructor.name ]);
                })());
            };
            var validate3 = function (v1) {
                return new Data_Tuple.Tuple(v1.value0, validate2(new Data_Tuple.Tuple(v1.value1.value0, v1.value1.value1)));
            };
            if (v.value1 instanceof Task_Script_Syntax.Enter) {
                return Task_Script_Annotation.lift(g)(v.value1)(new Task_Script_Syntax.Enter(v.value1.value0))(Data_Functor.mapFlipped(Data_Either.functorEither)(Data_Functor.mapFlipped(Data_Either.functorEither)(Data_Either.note(new Task_Script_Error.UnknownTypeName(v.value1.value0))(Data_HashMap.lookup(Data_Hashable.hashableString)(v.value1.value0)(s)))(Task_Script_Type.ofBasic))(Task_Script_Checker.wrapValue));
            };
            if (v.value1 instanceof Task_Script_Syntax.Update) {
                return Task_Script_Annotation.lift(g)(v.value1)(new Task_Script_Syntax.Update(v.value1.value0))(Data_Functor.mapFlipped(Data_Either.functorEither)(Control_Bind.bind(Data_Either.bindEither)(Task_Script_Checker.check(Task_Script_Checker["$_CheckExpression_8"])(s)(g)(v.value1.value0))(Task_Script_Checker.needBasic))(Task_Script_Checker.wrapValue));
            };
            if (v.value1 instanceof Task_Script_Syntax.Change) {
                return Task_Script_Annotation.lift(g)(v.value1)(new Task_Script_Syntax.Change(v.value1.value0))(Data_Functor.mapFlipped(Data_Either.functorEither)(Control_Bind.bind(Data_Either.bindEither)(Task_Script_Checker.check(Task_Script_Checker["$_CheckExpression_8"])(s)(g)(v.value1.value0))(Task_Script_Checker.outofReference))(Task_Script_Checker.wrapValue));
            };
            if (v.value1 instanceof Task_Script_Syntax.View) {
                return Task_Script_Annotation.lift(g)(v.value1)(new Task_Script_Syntax.View(v.value1.value0))(Data_Functor.mapFlipped(Data_Either.functorEither)(Control_Bind.bind(Data_Either.bindEither)(Task_Script_Checker.check(Task_Script_Checker["$_CheckExpression_8"])(s)(g)(v.value1.value0))(Task_Script_Checker.needBasic))(Task_Script_Checker.wrapValue));
            };
            if (v.value1 instanceof Task_Script_Syntax.Watch) {
                return Task_Script_Annotation.lift(g)(v.value1)(new Task_Script_Syntax.Watch(v.value1.value0))(Data_Functor.mapFlipped(Data_Either.functorEither)(Control_Bind.bind(Data_Either.bindEither)(Task_Script_Checker.check(Task_Script_Checker["$_CheckExpression_8"])(s)(g)(v.value1.value0))(Task_Script_Checker.outofReference))(Task_Script_Checker.wrapValue));
            };
            if (v.value1 instanceof Task_Script_Syntax.Lift) {
                return Task_Script_Annotation.lift(g)(v.value1)(new Task_Script_Syntax.Lift(v.value1.value0))(Data_Functor.mapFlipped(Data_Either.functorEither)(Control_Bind.bind(Data_Either.bindEither)(Task_Script_Checker.check(Task_Script_Checker["$_CheckExpression_8"])(s)(g)(v.value1.value0))(Task_Script_Checker.outofRecord))(Task_Script_Type.TTask.create));
            };
            if (v.value1 instanceof Task_Script_Syntax.Pair) {
                var cs = Data_Functor.map(Data_Functor.functorArray)(validate1)(v.value1.value0);
                return Task_Script_Annotation.sink(g)(new Task_Script_Syntax.Pair(cs))(Data_Functor.mapFlipped(Data_Either.functorEither)(Control_Bind.bind(Data_Either.bindEither)(Data_Traversable.traverse(Data_Traversable.traversableArray)(Data_Either.applicativeEither)(outofBranch)(cs))(Task_Script_Checker.unite(Data_Foldable.foldableArray)))(Task_Script_Type.TTask.create));
            };
            if (v.value1 instanceof Task_Script_Syntax.Choose) {
                var cs = Data_Functor.map(Data_Functor.functorArray)(validate1)(v.value1.value0);
                return Task_Script_Annotation.sink(g)(new Task_Script_Syntax.Choose(cs))(Data_Functor.mapFlipped(Data_Either.functorEither)(Control_Bind.bind(Data_Either.bindEither)(Data_Traversable.traverse(Data_Traversable.traversableArray)(Data_Either.applicativeEither)(outofBranch)(cs))(Task_Script_Checker.intersect(Data_Foldable.foldableArray)))(Task_Script_Type.TTask.create));
            };
            if (v.value1 instanceof Task_Script_Syntax.Branch) {
                var cs = Data_Functor.map(Data_Functor.functorArray)(validate2)(v.value1.value0);
                return Task_Script_Annotation.sink(g)(new Task_Script_Syntax.Branch(cs))(Data_Functor.mapFlipped(Data_Either.functorEither)(Control_Bind.bind(Data_Either.bindEither)(Data_Traversable.traverse(Data_Traversable.traversableArray)(Data_Either.applicativeEither)(function ($73) {
                    return outofBranch(Data_Tuple.snd($73));
                })(cs))(Task_Script_Checker.intersect(Data_Foldable.foldableArray)))(Task_Script_Type.TTask.create));
            };
            if (v.value1 instanceof Task_Script_Syntax.Select) {
                var cs = Data_Functor.map(Data_Functor.functorArray)(validate3)(v.value1.value0);
                return Task_Script_Annotation.sink(g)(new Task_Script_Syntax.Select(cs))(Data_Functor.mapFlipped(Data_Either.functorEither)(Control_Bind.bind(Data_Either.bindEither)(Data_Traversable.traverse(Data_Traversable.traversableArray)(Data_Either.applicativeEither)(function ($74) {
                    return outofBranch(Data_Tuple.snd(Data_Tuple.snd($74)));
                })(cs))(Task_Script_Checker.intersect(Data_Foldable.foldableArray)))(Task_Script_Type.TTask.create));
            };
            if (v.value1 instanceof Task_Script_Syntax.Step) {
                var c2 = validate(s)(g)(v.value1.value2);
                var c1 = validate(s)(g)(v.value1.value1);
                return Task_Script_Annotation.withTypeOf(c1)(new Task_Script_Syntax.Step(v.value1.value0, c1, c2))(function (t1) {
                    if (t1 instanceof Task_Script_Type.TTask) {
                        var v1 = Task_Script_Checker.match(v.value1.value0)(new Task_Script_Type.TRecord(t1.value0));
                        if (v1 instanceof Data_Either.Left) {
                            return Task_Script_Annotation.fail(g)(v.value1)(v1.value0);
                        };
                        if (v1 instanceof Data_Either.Right) {
                            var g$prime = Data_HashMap.union(Data_Hashable.hashableString)(g)(v1.value0);
                            var c2$prime = validate(s)(g$prime)(v.value1.value2);
                            return Task_Script_Annotation.withTypeOf(c2$prime)(new Task_Script_Syntax.Step(v.value1.value0, c1, c2$prime))(function (t2) {
                                if (t2 instanceof Task_Script_Type.TTask) {
                                    return Task_Script_Annotation.pass(g$prime)(new Task_Script_Syntax.Step(v.value1.value0, c1, c2$prime))(new Task_Script_Type.TTask(t2.value0));
                                };
                                return Task_Script_Annotation.bury(new Task_Script_Syntax.Step(v.value1.value0, c1, Task_Script_Annotation.fail(g$prime)(v.value1.value2.value1)(new Task_Script_Error.TaskNeeded(t2))));
                            });
                        };
                        throw new Error("Failed pattern match at Task.Script.Validator (line 43, column 19 - line 51, column 22): " + [ v1.constructor.name ]);
                    };
                    return Task_Script_Annotation.bury(new Task_Script_Syntax.Step(v.value1.value0, Task_Script_Annotation.fail(g)(v.value1.value1.value1)(new Task_Script_Error.TaskNeeded(t1)), c2));
                });
            };
            if (v.value1 instanceof Task_Script_Syntax.Execute) {
                return Task_Script_Annotation.lift(g)(v.value1)(new Task_Script_Syntax.Execute(v.value1.value0, v.value1.value1))(Control_Bind.bind(Data_Either.bindEither)(Data_Either.note(new Task_Script_Error.UnknownVariable(v.value1.value0))(Data_HashMap.lookup(Data_Hashable.hashableString)(v.value1.value0)(g)))(function (t_n) {
                    if (t_n instanceof Task_Script_Type.TFunction) {
                        return Control_Bind.bind(Data_Either.bindEither)(Task_Script_Checker.check(Task_Script_Checker["$_CheckArguments_9"])(s)(g)(v.value1.value1))(function (t_a) {
                            var $61 = Data_Eq.eq(Task_Script_Type["$_EqFullType_48"])(t_n.value0)(t_a);
                            if ($61) {
                                return Preload.done(Data_Either.applicativeEither)(t_n.value1);
                            };
                            return Preload["throw"](new Task_Script_Error.ArgumentError(t_n.value0, t_a));
                        });
                    };
                    return Preload["throw"](new Task_Script_Error.FunctionNeeded(t_n));
                }));
            };
            if (v.value1 instanceof Task_Script_Syntax.Hole) {
                return Task_Script_Annotation.fail(g)(v.value1)(new Task_Script_Error.HoleFound(g));
            };
            if (v.value1 instanceof Task_Script_Syntax.Share) {
                return Task_Script_Annotation.lift(g)(v.value1)(new Task_Script_Syntax.Share(v.value1.value0))(Control_Bind.bind(Data_Either.bindEither)(Task_Script_Checker.check(Task_Script_Checker["$_CheckExpression_8"])(s)(g)(v.value1.value0))(function (t) {
                    return Control_Bind.bind(Data_Either.bindEither)(Task_Script_Checker.outofBasic(t))(function (b) {
                        return Preload.done(Data_Either.applicativeEither)(Task_Script_Checker.wrapValue(new Task_Script_Type.TReference(b)));
                    });
                }));
            };
            if (v.value1 instanceof Task_Script_Syntax.Assign) {
                return Task_Script_Annotation.lift(g)(v.value1)(new Task_Script_Syntax.Assign(v.value1.value0, v.value1.value1))(Control_Bind.bind(Data_Either.bindEither)(Task_Script_Checker.check(Task_Script_Checker["$_CheckExpression_8"])(s)(g)(v.value1.value0))(function (t1) {
                    return Control_Bind.bind(Data_Either.bindEither)(Task_Script_Checker.outofReference(t1))(function (b1) {
                        return Control_Bind.bind(Data_Either.bindEither)(Task_Script_Checker.check(Task_Script_Checker["$_CheckExpression_8"])(s)(g)(v.value1.value1))(function (b2) {
                            var $68 = Data_Eq.eq(Task_Script_Type["$_EqFullType_48"])(b1)(b2);
                            if ($68) {
                                return Preload.done(Data_Either.applicativeEither)(new Task_Script_Type.TRecord(Data_HashMap.empty));
                            };
                            return Preload["throw"](new Task_Script_Error.AssignError(b1, b2));
                        });
                    });
                }));
            };
            throw new Error("Failed pattern match at Task.Script.Validator (line 18, column 32 - line 83, column 35): " + [ v.value1.constructor.name ]);
        };
    };
};
module.exports = {
    validate: validate
};
