// Generated by purs version 0.14.2
"use strict";
var Control_Bind = require("../Control.Bind/index.js");
var Data_Either = require("../Data.Either/index.js");
var Data_HashMap = require("../Data.HashMap/index.js");
var Data_Hashable = require("../Data.Hashable/index.js");
var Data_Traversable = require("../Data.Traversable/index.js");
var Data_Tuple = require("../Data.Tuple/index.js");
var Preload = require("../Preload/index.js");
var Task_Script_Annotation = require("../Task.Script.Annotation/index.js");
var Task_Script_Checker = require("../Task.Script.Checker/index.js");
var Task_Script_Context = require("../Task.Script.Context/index.js");
var Task_Script_Expander = require("../Task.Script.Expander/index.js");
var Task_Script_Validator = require("../Task.Script.Validator/index.js");
var load = function (s) {
    return function (g) {
        var types = Data_HashMap.union(Data_Hashable.hashableString)(s)(Task_Script_Context.aliases);
        var names = Data_HashMap.union(Data_Hashable.hashableString)(g)(Task_Script_Context.builtins);
        return Control_Bind.bind(Data_Either.bindEither)(Data_Traversable.traverse(Data_HashMap.traversableHashMap)(Data_Either.applicativeEither)(Task_Script_Expander.expand(Task_Script_Expander["$_ExpandBasicType_3"])(types))(types))(function (types$prime) {
            return Control_Bind.bind(Data_Either.bindEither)(Data_Traversable.traverse(Data_HashMap.traversableHashMap)(Data_Either.applicativeEither)(Task_Script_Expander.expand(Task_Script_Expander["$_ExpandFullType_2"])(types$prime))(names))(function (names$prime) {
                return Preload.done(Data_Either.applicativeEither)(new Data_Tuple.Tuple(types$prime, names$prime));
            });
        });
    };
};
var validate = function (s) {
    return function (g) {
        return function (v) {
            var v1 = load(s)(g);
            if (v1 instanceof Data_Either.Right) {
                return Task_Script_Validator.validate(v1.value0.value0)(v1.value0.value1)(v);
            };
            if (v1 instanceof Data_Either.Left) {
                return new Task_Script_Annotation.Annotated(new Task_Script_Annotation.Failure(g, v1.value0), v.value1);
            };
            throw new Error("Failed pattern match at Task.Script.Loader (line 30, column 34 - line 32, column 42): " + [ v1.constructor.name ]);
        };
    };
};
var check = function (s) {
    return function (g) {
        return function (t) {
            return Control_Bind.bind(Data_Either.bindEither)(load(s)(g))(function (v) {
                return Task_Script_Checker.check(Task_Script_Checker["$_CheckAnnotatedTask_10"])(v.value0)(v.value1)(t);
            });
        };
    };
};
module.exports = {
    load: load,
    check: check,
    validate: validate
};
