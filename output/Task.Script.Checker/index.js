// Generated by purs version 0.14.2
"use strict";
var Control_Bind = require("../Control.Bind/index.js");
var Data_Array = require("../Data.Array/index.js");
var Data_Boolean = require("../Data.Boolean/index.js");
var Data_Either = require("../Data.Either/index.js");
var Data_Eq = require("../Data.Eq/index.js");
var Data_Foldable = require("../Data.Foldable/index.js");
var Data_Functor = require("../Data.Functor/index.js");
var Data_HashMap = require("../Data.HashMap/index.js");
var Data_HashSet = require("../Data.HashSet/index.js");
var Data_Hashable = require("../Data.Hashable/index.js");
var Data_HeytingAlgebra = require("../Data.HeytingAlgebra/index.js");
var Data_Maybe = require("../Data.Maybe/index.js");
var Data_Traversable = require("../Data.Traversable/index.js");
var Data_Tuple = require("../Data.Tuple/index.js");
var Preload = require("../Preload/index.js");
var Task_Script_Error = require("../Task.Script.Error/index.js");
var Task_Script_Syntax = require("../Task.Script.Syntax/index.js");
var Task_Script_Type = require("../Task.Script.Type/index.js");
var Check = function (check) {
    this.check = check;
};
var wrapValue = function (t) {
    return Task_Script_Type.TTask.create(Preload.from(Preload["$_InitialiseHashMap*_14"](Data_Hashable.hashableString))([ new Data_Tuple.Tuple("value", t) ]));
};
var smash = function (r) {
    var v = Data_Array.uncons(Data_HashMap.values(r));
    if (v instanceof Data_Maybe.Nothing) {
        return Preload["throw"](Task_Script_Error.EmptyCase.value);
    };
    if (v instanceof Data_Maybe.Just) {
        var $28 = Data_Foldable.all(Data_Foldable.foldableArray)(Data_HeytingAlgebra.heytingAlgebraBoolean)(function (v1) {
            return Data_Eq.eq(Task_Script_Type["$_EqFullType_48"])(v1)(v.value0.head);
        })(v.value0.tail);
        if ($28) {
            return Preload.done(Data_Either.applicativeEither)(v.value0.head);
        };
        return Preload["throw"](new Task_Script_Error.BranchesError(r));
    };
    throw new Error("Failed pattern match at Task.Script.Checker (line 219, column 11 - line 225, column 31): " + [ v.constructor.name ]);
};
var outofTask = function (t) {
    var v = function (v1) {
        if (Data_Boolean.otherwise) {
            return Preload["throw"](new Task_Script_Error.TaskNeeded(t));
        };
        throw new Error("Failed pattern match at Task.Script.Checker (line 249, column 1 - line 249, column 50): " + [ t.constructor.name ]);
    };
    var $34 = Task_Script_Type.ofTask(t);
    if ($34 instanceof Data_Maybe.Just) {
        return Preload.done(Data_Either.applicativeEither)($34.value0);
    };
    return v(true);
};
var outofReference = function (t) {
    var v = function (v1) {
        if (Data_Boolean.otherwise) {
            return Preload["throw"](new Task_Script_Error.ReferenceNeeded(t));
        };
        throw new Error("Failed pattern match at Task.Script.Checker (line 244, column 1 - line 244, column 47): " + [ t.constructor.name ]);
    };
    var $38 = Task_Script_Type.ofReference(t);
    if ($38 instanceof Data_Maybe.Just) {
        return Preload.done(Data_Either.applicativeEither)(Task_Script_Type.ofBasic($38.value0));
    };
    return v(true);
};
var outofRecord = function (t) {
    var v = function (v1) {
        if (Data_Boolean.otherwise) {
            return Preload["throw"](new Task_Script_Error.RecordNeeded(t));
        };
        throw new Error("Failed pattern match at Task.Script.Checker (line 239, column 1 - line 239, column 52): " + [ t.constructor.name ]);
    };
    var $42 = Task_Script_Type.ofRecord(t);
    if ($42 instanceof Data_Maybe.Just) {
        return Preload.done(Data_Either.applicativeEither)($42.value0);
    };
    return v(true);
};
var outofBasic = function (t) {
    var v = function (v1) {
        if (Data_Boolean.otherwise) {
            return Preload["throw"](new Task_Script_Error.BasicNeeded(t));
        };
        throw new Error("Failed pattern match at Task.Script.Checker (line 234, column 1 - line 234, column 44): " + [ t.constructor.name ]);
    };
    var $46 = Task_Script_Type.ofType(t);
    if ($46 instanceof Data_Maybe.Just) {
        return Preload.done(Data_Either.applicativeEither)($46.value0);
    };
    return v(true);
};
var needBasic = function (t) {
    if (Task_Script_Type.isBasic(t)) {
        return Preload.done(Data_Either.applicativeEither)(t);
    };
    if (Data_Boolean.otherwise) {
        return Preload["throw"](new Task_Script_Error.BasicNeeded(t));
    };
    throw new Error("Failed pattern match at Task.Script.Checker (line 229, column 1 - line 229, column 42): " + [ t.constructor.name ]);
};
var keys = function (dictHashable) {
    var $151 = Preload.from(Preload["$_InitialiseHashSet_13"](dictHashable));
    return function ($152) {
        return $151(Data_HashMap.keys($152));
    };
};
var merge = function (r1) {
    return function (r2) {
        var ds = Data_HashMap.difference(Data_Hashable.hashableString)(r1)(r2);
        var $49 = Data_HashMap.isEmpty(ds);
        if ($49) {
            return Preload.done(Data_Either.applicativeEither)(Data_HashMap.intersectionWith(Data_Hashable.hashableString)(Data_Tuple.Tuple.create)(r1)(r2));
        };
        return Preload["throw"](new Task_Script_Error.UnknownLabels(keys(Data_Hashable.hashableString)(ds), keys(Data_Hashable.hashableString)(r2)));
    };
};
var unite = function (dictFoldable) {
    var go = function (acc) {
        return function (r) {
            var is = Data_HashSet.intersection(Data_Hashable.hashableString)(keys(Data_Hashable.hashableString)(r))(keys(Data_Hashable.hashableString)(acc));
            var $50 = Data_Foldable["null"](Data_HashSet.foldableHashSet)(is);
            if ($50) {
                return Preload.done(Data_Either.applicativeEither)(Data_HashMap.union(Data_Hashable.hashableString)(acc)(r));
            };
            return Preload["throw"](new Task_Script_Error.DoubleLabels(is, keys(Data_Hashable.hashableString)(r)));
        };
    };
    return Preload.gather(dictFoldable)(Data_Either.monadEither)(go)(Data_HashMap.empty);
};
var match = function (m) {
    return function (t) {
        if (m instanceof Task_Script_Syntax.MIgnore) {
            return Preload.done(Data_Either.applicativeEither)(Data_HashMap.empty);
        };
        if (m instanceof Task_Script_Syntax.MBind) {
            return Preload.done(Data_Either.applicativeEither)(Preload.from(Preload["$_InitialiseHashMap*_14"](Data_Hashable.hashableString))([ new Data_Tuple.Tuple(m.value0, t) ]));
        };
        if (m instanceof Task_Script_Syntax.MRecord) {
            if (t instanceof Task_Script_Type.TRecord) {
                return Control_Bind.bind(Data_Either.bindEither)(Control_Bind.bind(Data_Either.bindEither)(merge(m.value0)(t.value0))(Data_Traversable.traverse(Data_HashMap.traversableHashMap)(Data_Either.applicativeEither)(Data_Tuple.uncurry(match))))(unite(Data_HashMap.foldableHashMap));
            };
            return Preload["throw"](new Task_Script_Error.RecordMismatch(m.value0, t));
        };
        if (m instanceof Task_Script_Syntax.MUnpack) {
            if (t instanceof Task_Script_Type.TRecord) {
                return Preload.done(Data_Either.applicativeEither)(t.value0);
            };
            return Preload["throw"](new Task_Script_Error.UnpackMismatch(t));
        };
        throw new Error("Failed pattern match at Task.Script.Checker (line 166, column 13 - line 176, column 37): " + [ m.constructor.name ]);
    };
};
var intersect = function (dictFoldable) {
    return function (rs) {
        return Data_Either.note(Task_Script_Error.EmptyChoice.value)(Preload.foldr1(dictFoldable)(Data_HashMap.intersection(Data_Hashable.hashableString))(rs));
    };
};
var check = function (dict) {
    return dict.check;
};
var $dollar_CheckExpression_8 = new Check(function (s) {
    return function (g) {
        return function (v) {
            if (v instanceof Task_Script_Syntax.Variable) {
                return Data_Either.note(new Task_Script_Error.UnknownVariable(v.value0))(Data_HashMap.lookup(Data_Hashable.hashableString)(v.value0)(g));
            };
            if (v instanceof Task_Script_Syntax.Lambda) {
                return Control_Bind.bind(Data_Either.bindEither)(match(v.value0)(v.value1))(function (d) {
                    return Control_Bind.bind(Data_Either.bindEither)(check($dollar_CheckExpression_8)(s)(Data_HashMap.union(Data_Hashable.hashableString)(g)(d))(v.value2))(function (t$prime) {
                        return Preload.done(Data_Either.applicativeEither)(new Task_Script_Type.TFunction(v.value1, t$prime));
                    });
                });
            };
            if (v instanceof Task_Script_Syntax.Apply) {
                return Control_Bind.bind(Data_Either.bindEither)(check($dollar_CheckExpression_8)(s)(g)(v.value0))(function (t1) {
                    if (t1 instanceof Task_Script_Type.TFunction) {
                        return Control_Bind.bind(Data_Either.bindEither)(check($dollar_CheckExpression_8)(s)(g)(v.value1))(function (t2) {
                            var $64 = Data_Eq.eq(Task_Script_Type["$_EqFullType_48"])(t1.value0)(t2);
                            if ($64) {
                                return Preload.done(Data_Either.applicativeEither)(t1.value1);
                            };
                            return Preload["throw"](new Task_Script_Error.ArgumentError(t1.value0, t2));
                        });
                    };
                    return Preload["throw"](new Task_Script_Error.FunctionNeeded(t1));
                });
            };
            if (v instanceof Task_Script_Syntax.IfThenElse) {
                return Control_Bind.bind(Data_Either.bindEither)(check($dollar_CheckExpression_8)(s)(g)(v.value0))(function (t1) {
                    if (t1 instanceof Task_Script_Type.TPrimitive && t1.value0 instanceof Task_Script_Type.TBool) {
                        return Control_Bind.bind(Data_Either.bindEither)(check($dollar_CheckExpression_8)(s)(g)(v.value1))(function (t2) {
                            return Control_Bind.bind(Data_Either.bindEither)(check($dollar_CheckExpression_8)(s)(g)(v.value2))(function (t3) {
                                var $70 = Data_Eq.eq(Task_Script_Type["$_EqFullType_48"])(t2)(t3);
                                if ($70) {
                                    return Preload.done(Data_Either.applicativeEither)(t2);
                                };
                                return Preload["throw"](new Task_Script_Error.BranchError(t2, t3));
                            });
                        });
                    };
                    return Preload["throw"](new Task_Script_Error.BoolNeeded(t1));
                });
            };
            if (v instanceof Task_Script_Syntax.Case) {
                return Control_Bind.bind(Data_Either.bindEither)(check($dollar_CheckExpression_8)(s)(g)(v.value0))(function (t0) {
                    if (t0 instanceof Task_Script_Type.TVariant) {
                        return Control_Bind.bind(Data_Either.bindEither)(merge(t0.value0)(v.value1))(function (bs$prime) {
                            return Control_Bind.bind(Data_Either.bindEither)(Data_Traversable["for"](Data_Either.applicativeEither)(Data_HashMap.traversableHashMap)(bs$prime)(function (v1) {
                                return Control_Bind.bind(Data_Either.bindEither)(match(v1.value1.value0)(v1.value0))(function (d) {
                                    return check($dollar_CheckExpression_8)(s)(Data_HashMap.union(Data_Hashable.hashableString)(g)(d))(v1.value1.value1);
                                });
                            }))(function (ts) {
                                return smash(ts);
                            });
                        });
                    };
                    return Preload["throw"](new Task_Script_Error.VariantNeeded(t0));
                });
            };
            if (v instanceof Task_Script_Syntax.Record) {
                return Data_Functor.mapFlipped(Data_Either.functorEither)(Data_Traversable.traverse(Data_HashMap.traversableHashMap)(Data_Either.applicativeEither)(check($dollar_CheckExpression_8)(s)(g))(v.value0))(Task_Script_Type.TRecord.create);
            };
            if (v instanceof Task_Script_Syntax.Wildcard) {
                return Preload.done(Data_Either.applicativeEither)(new Task_Script_Type.TRecord(Data_HashMap.filter((function () {
                    var $153 = Data_HeytingAlgebra.not(Data_HeytingAlgebra.heytingAlgebraBoolean);
                    return function ($154) {
                        return $153(Task_Script_Type.isFunction($154));
                    };
                })())(g)));
            };
            if (v instanceof Task_Script_Syntax.Variant) {
                if (v.value2 instanceof Task_Script_Type.TVariant) {
                    return Control_Bind.bind(Data_Either.bindEither)(check($dollar_CheckExpression_8)(s)(g)(v.value1))(function (t_e) {
                        var v1 = Data_HashMap.lookup(Data_Hashable.hashableString)(v.value0)(v.value2.value0);
                        if (v1 instanceof Data_Maybe.Just) {
                            var $87 = Data_Eq.eq(Task_Script_Type["$_EqFullType_48"])(t_e)(v1.value0);
                            if ($87) {
                                return Preload.done(Data_Either.applicativeEither)(v.value2);
                            };
                            return Preload["throw"](new Task_Script_Error.VariantError(v.value0, v1.value0, t_e));
                        };
                        if (v1 instanceof Data_Maybe.Nothing) {
                            return Preload["throw"](new Task_Script_Error.UnknownLabel(v.value0, v.value2));
                        };
                        throw new Error("Failed pattern match at Task.Script.Checker (line 83, column 9 - line 89, column 47): " + [ v1.constructor.name ]);
                    });
                };
                return Preload["throw"](new Task_Script_Error.VariantNeeded(v.value2));
            };
            if (v instanceof Task_Script_Syntax.Nil) {
                return Preload.done(Data_Either.applicativeEither)(new Task_Script_Type.TList(v.value0));
            };
            if (v instanceof Task_Script_Syntax.Cons) {
                return Control_Bind.bind(Data_Either.bindEither)(check($dollar_CheckExpression_8)(s)(g)(v.value0))(function (t1) {
                    return Control_Bind.bind(Data_Either.bindEither)(check($dollar_CheckExpression_8)(s)(g)(v.value1))(function (t2) {
                        if (t2 instanceof Task_Script_Type.TList) {
                            var $95 = Data_Eq.eq(Task_Script_Type["$_EqFullType_48"])(t2)(t2.value0);
                            if ($95) {
                                return Preload.done(Data_Either.applicativeEither)(t2);
                            };
                            return Preload["throw"](new Task_Script_Error.ListError(t1, t2));
                        };
                        return Preload["throw"](new Task_Script_Error.ListNeeded(t2));
                    });
                });
            };
            if (v instanceof Task_Script_Syntax.Constant && v.value0 instanceof Task_Script_Syntax.B) {
                return Preload.done(Data_Either.applicativeEither)(new Task_Script_Type.TPrimitive(Task_Script_Type.TBool.value));
            };
            if (v instanceof Task_Script_Syntax.Constant && v.value0 instanceof Task_Script_Syntax.I) {
                return Preload.done(Data_Either.applicativeEither)(new Task_Script_Type.TPrimitive(Task_Script_Type.TInt.value));
            };
            if (v instanceof Task_Script_Syntax.Constant && v.value0 instanceof Task_Script_Syntax.S) {
                return Preload.done(Data_Either.applicativeEither)(new Task_Script_Type.TPrimitive(Task_Script_Type.TString.value));
            };
            throw new Error("Failed pattern match at Task.Script.Checker (line 37, column 15 - line 106, column 49): " + [ v.constructor.name ]);
        };
    };
});
var $dollar_CheckArguments_9 = new Check(function (s) {
    return function (g) {
        return function (v) {
            return Data_Functor.mapFlipped(Data_Either.functorEither)(Data_Traversable.traverse(Data_HashMap.traversableHashMap)(Data_Either.applicativeEither)(check($dollar_CheckExpression_8)(s)(g))(v.value0))(Task_Script_Type.TRecord.create);
        };
    };
});
var $dollar_CheckTask_11 = function (dictCheck) {
    return new Check(function (s) {
        return function (g) {
            var subcheck = function (t) {
                return Control_Bind.bind(Data_Either.bindEither)(check(dictCheck)(s)(g)(t))(outofTask);
            };
            var subcheck$prime = function (v) {
                return Control_Bind.bind(Data_Either.bindEither)(check($dollar_CheckExpression_8)(s)(g)(v.value0))(function (t_e) {
                    if (t_e instanceof Task_Script_Type.TPrimitive && t_e.value0 instanceof Task_Script_Type.TBool) {
                        return subcheck(v.value1);
                    };
                    return Preload["throw"](new Task_Script_Error.BoolNeeded(t_e));
                });
            };
            var subcheck$prime$prime = function (v) {
                return subcheck$prime(new Data_Tuple.Tuple(v.value1.value0, v.value1.value1));
            };
            return function (v) {
                if (v instanceof Task_Script_Syntax.Enter) {
                    return Data_Functor.mapFlipped(Data_Either.functorEither)(Data_Functor.mapFlipped(Data_Either.functorEither)(Data_Either.note(new Task_Script_Error.UnknownTypeName(v.value0))(Data_HashMap.lookup(Data_Hashable.hashableString)(v.value0)(s)))(Task_Script_Type.ofBasic))(wrapValue);
                };
                if (v instanceof Task_Script_Syntax.Update) {
                    return Data_Functor.mapFlipped(Data_Either.functorEither)(Control_Bind.bind(Data_Either.bindEither)(check($dollar_CheckExpression_8)(s)(g)(v.value0))(needBasic))(wrapValue);
                };
                if (v instanceof Task_Script_Syntax.Change) {
                    return Data_Functor.mapFlipped(Data_Either.functorEither)(Control_Bind.bind(Data_Either.bindEither)(check($dollar_CheckExpression_8)(s)(g)(v.value0))(outofReference))(wrapValue);
                };
                if (v instanceof Task_Script_Syntax.View) {
                    return Data_Functor.mapFlipped(Data_Either.functorEither)(Control_Bind.bind(Data_Either.bindEither)(check($dollar_CheckExpression_8)(s)(g)(v.value0))(needBasic))(wrapValue);
                };
                if (v instanceof Task_Script_Syntax.Watch) {
                    return Data_Functor.mapFlipped(Data_Either.functorEither)(Control_Bind.bind(Data_Either.bindEither)(check($dollar_CheckExpression_8)(s)(g)(v.value0))(outofReference))(wrapValue);
                };
                if (v instanceof Task_Script_Syntax.Lift) {
                    return Data_Functor.mapFlipped(Data_Either.functorEither)(Control_Bind.bind(Data_Either.bindEither)(check($dollar_CheckExpression_8)(s)(g)(v.value0))(outofRecord))(Task_Script_Type.TTask.create);
                };
                if (v instanceof Task_Script_Syntax.Pair) {
                    return Data_Functor.mapFlipped(Data_Either.functorEither)(Control_Bind.bind(Data_Either.bindEither)(Data_Traversable.traverse(Data_Traversable.traversableArray)(Data_Either.applicativeEither)(subcheck)(v.value0))(unite(Data_Foldable.foldableArray)))(Task_Script_Type.TTask.create);
                };
                if (v instanceof Task_Script_Syntax.Choose) {
                    return Data_Functor.mapFlipped(Data_Either.functorEither)(Control_Bind.bind(Data_Either.bindEither)(Data_Traversable.traverse(Data_Traversable.traversableArray)(Data_Either.applicativeEither)(subcheck)(v.value0))(intersect(Data_Foldable.foldableArray)))(Task_Script_Type.TTask.create);
                };
                if (v instanceof Task_Script_Syntax.Branch) {
                    return Data_Functor.mapFlipped(Data_Either.functorEither)(Control_Bind.bind(Data_Either.bindEither)(Data_Traversable.traverse(Data_Traversable.traversableArray)(Data_Either.applicativeEither)(subcheck$prime)(v.value0))(intersect(Data_Foldable.foldableArray)))(Task_Script_Type.TTask.create);
                };
                if (v instanceof Task_Script_Syntax.Select) {
                    return Data_Functor.mapFlipped(Data_Either.functorEither)(Control_Bind.bind(Data_Either.bindEither)(Data_Traversable.traverse(Data_Traversable.traversableArray)(Data_Either.applicativeEither)(subcheck$prime$prime)(v.value0))(intersect(Data_Foldable.foldableArray)))(Task_Script_Type.TTask.create);
                };
                if (v instanceof Task_Script_Syntax.Step) {
                    return Control_Bind.bind(Data_Either.bindEither)(check(dictCheck)(s)(g)(v.value1))(function (t_u1) {
                        if (t_u1 instanceof Task_Script_Type.TTask) {
                            return Control_Bind.bind(Data_Either.bindEither)(match(v.value0)(new Task_Script_Type.TRecord(t_u1.value0)))(function (d) {
                                return check(dictCheck)(s)(Data_HashMap.union(Data_Hashable.hashableString)(g)(d))(v.value2);
                            });
                        };
                        return Preload["throw"](new Task_Script_Error.TaskNeeded(t_u1));
                    });
                };
                if (v instanceof Task_Script_Syntax.Execute) {
                    return Control_Bind.bind(Data_Either.bindEither)(Data_Either.note(new Task_Script_Error.UnknownVariable(v.value0))(Data_HashMap.lookup(Data_Hashable.hashableString)(v.value0)(g)))(function (t_x) {
                        if (t_x instanceof Task_Script_Type.TFunction) {
                            return Control_Bind.bind(Data_Either.bindEither)(check($dollar_CheckArguments_9)(s)(g)(v.value1))(function (t_a) {
                                var $136 = Data_Eq.eq(Task_Script_Type["$_EqFullType_48"])(t_x.value0)(t_a);
                                if ($136) {
                                    return Preload.done(Data_Either.applicativeEither)(t_x.value1);
                                };
                                return Preload["throw"](new Task_Script_Error.ArgumentError(t_x.value0, t_a));
                            });
                        };
                        return Preload["throw"](new Task_Script_Error.FunctionNeeded(t_x));
                    });
                };
                if (v instanceof Task_Script_Syntax.Hole) {
                    return Preload["throw"](new Task_Script_Error.HoleFound(g));
                };
                if (v instanceof Task_Script_Syntax.Share) {
                    return Data_Functor.mapFlipped(Data_Either.functorEither)(Data_Functor.mapFlipped(Data_Either.functorEither)(Control_Bind.bind(Data_Either.bindEither)(check($dollar_CheckExpression_8)(s)(g)(v.value0))(outofBasic))(Task_Script_Type.TReference.create))(wrapValue);
                };
                if (v instanceof Task_Script_Syntax.Assign) {
                    return Control_Bind.bind(Data_Either.bindEither)(check($dollar_CheckExpression_8)(s)(g)(v.value0))(function (t1) {
                        return Control_Bind.bind(Data_Either.bindEither)(outofReference(t1))(function (b1) {
                            return Control_Bind.bind(Data_Either.bindEither)(check($dollar_CheckExpression_8)(s)(g)(v.value1))(function (b2) {
                                var $143 = Data_Eq.eq(Task_Script_Type["$_EqFullType_48"])(b1)(b2);
                                if ($143) {
                                    return Preload.done(Data_Either.applicativeEither)(new Task_Script_Type.TRecord(Data_HashMap.empty));
                                };
                                return Preload["throw"](new Task_Script_Error.AssignError(b1, b2));
                            });
                        });
                    });
                };
                throw new Error("Failed pattern match at Task.Script.Checker (line 115, column 15 - line 152, column 35): " + [ v.constructor.name ]);
            };
        };
    });
};
var $dollar_CheckAnnotatedTask_10 = new Check(function (s) {
    return function (g) {
        return function (v) {
            return check($dollar_CheckTask_11($dollar_CheckAnnotatedTask_10))(s)(g)(v.value1);
        };
    };
});
module.exports = {
    Check: Check,
    check: check,
    match: match,
    wrapValue: wrapValue,
    needBasic: needBasic,
    outofBasic: outofBasic,
    outofRecord: outofRecord,
    outofReference: outofReference,
    outofTask: outofTask,
    unite: unite,
    intersect: intersect,
    merge: merge,
    smash: smash,
    "$_CheckExpression_8": $dollar_CheckExpression_8,
    "$_CheckArguments_9": $dollar_CheckArguments_9,
    "$_CheckAnnotatedTask_10": $dollar_CheckAnnotatedTask_10,
    "$_CheckTask_11": $dollar_CheckTask_11
};
