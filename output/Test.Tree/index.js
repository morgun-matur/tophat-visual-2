// Generated by purs version 0.14.2
"use strict";
var Concur = require("../Concur/index.js");
var Concur_Core_FRP = require("../Concur.Core.FRP/index.js");
var Concur_Core_Props = require("../Concur.Core.Props/index.js");
var Concur_Core_Types = require("../Concur.Core.Types/index.js");
var Concur_Dom_Input = require("../Concur.Dom.Input/index.js");
var Concur_Dom_Style = require("../Concur.Dom.Style/index.js");
var Concur_Dom_Text = require("../Concur.Dom.Text/index.js");
var Concur_React_DOM = require("../Concur.React.DOM/index.js");
var Concur_React_Props = require("../Concur.React.Props/index.js");
var Control_Bind = require("../Control.Bind/index.js");
var Control_Cofree = require("../Control.Cofree/index.js");
var Data_Array = require("../Data.Array/index.js");
var Data_Functor = require("../Data.Functor/index.js");
var Data_Maybe = require("../Data.Maybe/index.js");
var Data_Monoid = require("../Data.Monoid/index.js");
var Data_Traversable = require("../Data.Traversable/index.js");
var Preload = require("../Preload/index.js");
var Tree = (function () {
    function Tree(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    Tree.create = function (value0) {
        return function (value1) {
            return new Tree(value0, value1);
        };
    };
    return Tree;
})();
var Rename = (function () {
    function Rename(value0) {
        this.value0 = value0;
    };
    Rename.create = function (value0) {
        return new Rename(value0);
    };
    return Rename;
})();
var Create = (function () {
    function Create() {

    };
    Create.value = new Create();
    return Create;
})();
var Delete = (function () {
    function Delete() {

    };
    Delete.value = new Delete();
    return Delete;
})();
var Modify = (function () {
    function Modify(value0) {
        this.value0 = value0;
    };
    Modify.create = function (value0) {
        return new Modify(value0);
    };
    return Modify;
})();
var title = function (old) {
    return Control_Bind.discard(Control_Bind.discardUnit)(Concur_Core_Types.widgetBind)(Concur_Dom_Style.element([ Data_Functor["void"](Concur_Core_Props.functorProps)(Concur_React_Props.onDoubleClick) ])([ Concur_Dom_Text.subhead(old) ]))(function () {
        return Control_Bind.bind(Concur_Core_Types.widgetBind)(Concur_Dom_Style.element([  ])([ Concur_Dom_Input.entry(Concur_Dom_Style.Medium.value)(old)(old), Data_Functor.voidLeft(Concur_Core_Types.widgetFunctor)(Concur_Dom_Input.button(Concur_Dom_Style.Default.value)(Concur_Dom_Style.Normal.value)(Concur_Dom_Style.Medium.value)("Cancel"))(old) ]))(function ($$new) {
            return Preload.done(Concur_Core_Types.widgetApplicative)((function () {
                var $3 = $$new === "";
                if ($3) {
                    return old;
                };
                return $$new;
            })());
        });
    });
};
var newTree = new Tree("New heading", [  ]);
var tree = function (v) {
    return Control_Bind.bind(Concur_Core_Types.widgetBind)(Concur_Dom_Text.bullets([ Concur_Dom_Style.element([  ])([ Data_Functor.map(Concur_Core_Types.widgetFunctor)(Rename.create)(title(v.value0)), Data_Functor.voidRight(Concur_Core_Types.widgetFunctor)(Create.value)(Concur_Dom_Input.button(Concur_Dom_Style.Default.value)(Concur_Dom_Style.Normal.value)(Concur_Dom_Style.Medium.value)("Create")), Data_Functor.voidRight(Concur_Core_Types.widgetFunctor)(Delete.value)(Concur_Dom_Input.button(Concur_Dom_Style.Default.value)(Concur_Dom_Style.Normal.value)(Concur_Dom_Style.Medium.value)("Delete")), Data_Functor.map(Concur_Core_Types.widgetFunctor)(Modify.create)(Concur.wither(Data_Monoid.monoidArray)(tree)(v.value1)) ]) ]))(function (result) {
        return Preload.done(Concur_Core_Types.widgetApplicative)((function () {
            if (result instanceof Rename) {
                return Data_Maybe.Just.create(new Tree(result.value0, v.value1));
            };
            if (result instanceof Create) {
                return Data_Maybe.Just.create(new Tree(v.value0, Data_Array.snoc(v.value1)(newTree)));
            };
            if (result instanceof Delete) {
                return Data_Maybe.Nothing.value;
            };
            if (result instanceof Modify) {
                return Data_Maybe.Just.create(new Tree(v.value0, result.value0));
            };
            throw new Error("Failed pattern match at Test.Tree (line 55, column 11 - line 59, column 52): " + [ result.constructor.name ]);
        })());
    });
};
var render = function (t) {
    return Control_Bind.bind(Concur_Core_Types.widgetBind)(tree(t))(function (mt) {
        if (mt instanceof Data_Maybe.Nothing) {
            return Concur_Dom_Text.subhead("Tree deleted");
        };
        if (mt instanceof Data_Maybe.Just) {
            return render(mt.value0);
        };
        throw new Error("Failed pattern match at Test.Tree (line 70, column 3 - line 72, column 25): " + [ mt.constructor.name ]);
    });
};
var tree_ = function (v) {
    return Concur_React_DOM.li_(Control_Cofree.shiftMapCofree(Data_Monoid.monoidArray))([  ])(Control_Bind.bind(Control_Cofree.bindCofree(Concur_Core_Types.widgetAlternative(Data_Monoid.monoidArray)))(Concur.loop(Concur_Core_Types.widgetMonad)(v.value0)(title))(function (name$prime) {
        return Control_Bind.bind(Control_Cofree.bindCofree(Concur_Core_Types.widgetAlternative(Data_Monoid.monoidArray)))(Concur_Core_FRP.step(false)(Data_Functor.voidLeft(Concur_Core_Types.widgetFunctor)(Concur_Dom_Input.button(Concur_Dom_Style.Default.value)(Concur_Dom_Style.Normal.value)(Concur_Dom_Style.Medium.value)("Delete"))(Preload.done(Control_Cofree.applicativeCofree(Concur_Core_Types.widgetAlternative(Data_Monoid.monoidArray)))(true))))(function (deleting) {
            if (deleting) {
                return Preload.done(Control_Cofree.applicativeCofree(Concur_Core_Types.widgetAlternative(Data_Monoid.monoidArray)))(Data_Maybe.Nothing.value);
            };
            return Control_Bind.bind(Control_Cofree.bindCofree(Concur_Core_Types.widgetAlternative(Data_Monoid.monoidArray)))(Concur_Core_FRP.step(Data_Maybe.Nothing.value)(Data_Functor.voidLeft(Concur_Core_Types.widgetFunctor)(Concur_Dom_Input.button(Concur_Dom_Style.Default.value)(Concur_Dom_Style.Normal.value)(Concur_Dom_Style.Medium.value)("New"))(Preload.done(Control_Cofree.applicativeCofree(Concur_Core_Types.widgetAlternative(Data_Monoid.monoidArray)))(new Data_Maybe.Just(newTree)))))(function (child$prime) {
                var children$prime = (function () {
                    if (child$prime instanceof Data_Maybe.Nothing) {
                        return v.value1;
                    };
                    if (child$prime instanceof Data_Maybe.Just) {
                        return Data_Array.snoc(v.value1)(child$prime.value0);
                    };
                    throw new Error("Failed pattern match at Test.Tree (line 93, column 21 - line 95, column 46): " + [ child$prime.constructor.name ]);
                })();
                return Control_Bind.bind(Control_Cofree.bindCofree(Concur_Core_Types.widgetAlternative(Data_Monoid.monoidArray)))(Concur_React_DOM.ul_(Control_Cofree.shiftMapCofree(Data_Monoid.monoidArray))([  ])(Data_Functor.map(Control_Cofree.functorCofree(Concur_Core_Types.widgetFunctor))(Data_Array.catMaybes)(Data_Traversable.traverse(Data_Traversable.traversableArray)(Control_Cofree.applicativeCofree(Concur_Core_Types.widgetAlternative(Data_Monoid.monoidArray)))(tree_)(children$prime))))(function (children$prime$prime) {
                    return Preload.done(Control_Cofree.applicativeCofree(Concur_Core_Types.widgetAlternative(Data_Monoid.monoidArray)))(new Data_Maybe.Just(new Tree(name$prime, children$prime$prime)));
                });
            });
        });
    }));
};
var render_ = function (v) {
    if (v instanceof Data_Maybe.Nothing) {
        return Preload.done(Control_Cofree.applicativeCofree(Concur_Core_Types.widgetAlternative(Data_Monoid.monoidArray)))(Data_Maybe.Nothing.value);
    };
    if (v instanceof Data_Maybe.Just) {
        return tree_(v.value0);
    };
    throw new Error("Failed pattern match at Test.Tree (line 100, column 11 - line 102, column 20): " + [ v.constructor.name ]);
};
var initTree = new Tree("Double click to edit me", [ new Tree("Or use the 'delete' button to delete me", [  ]), new Tree("Or use the 'new' button to add a sub node", [  ]) ]);
var main = render(initTree);
var main_ = Concur.dynamic(Concur_Core_Types.widgetMonad)(Concur.fix(Concur_Core_Types.widgetMonad)(new Data_Maybe.Just(initTree))(render_));
module.exports = {
    Tree: Tree,
    newTree: newTree,
    initTree: initTree,
    Rename: Rename,
    Create: Create,
    Delete: Delete,
    Modify: Modify,
    tree: tree,
    title: title,
    render: render,
    main: main,
    tree_: tree_,
    render_: render_,
    main_: main_
};
